{{- define "main" -}}

<article>
  <header class="mb-14">
    <h1 class="my-0! pb-2.5">{{- .Title -}}</h1>

    {{- if ne .Type "page" -}}
    <div class="text-xs antialiased opacity-60">
      {{- if .Date -}}
      <time>{{- .Date | time.Format ":date_medium" -}}</time>
      {{- end -}}<!---->
      {{- $single_author := or .Params.Author site.Author.name -}}
      <!---->
      {{- if $single_author -}}
      <span class="mx-1">&middot;</span>
      <span>{{- $single_author -}}</span>
      {{- end -}}
    </div>
    {{- end -}}
  </header>

  <section>{{-<div id="article-wrapper">
    <div class="post-content" id="post-content" style="filter: blur(12px); user-select: none; pointer-events: none; transition: 0.5s;">
        {{ .Content }}
    </div>

    <div id="pay-panel" style="text-align: center; margin-top: -150px; padding: 50px 20px; background: rgba(255,255,255,0.9); position: relative; z-index: 100; border: 1px solid #eee; border-radius: 12px;">
        <h3 style="color: #000;">ğŸ”’ é˜…åå³ç„šæˆ–æ°¸ä¹…æ”¶è—</h3>
        <p>æœ¬æ–‡éœ€æ”¯ä»˜ï¼š<strong style="color: #1890ff;">100 æšæ‚¨çš„ä»£å¸</strong></p>
        <button id="pay-btn" onclick="payWithMyToken()" style="background: #000; color: #fff; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
            ğŸ¦Š è¿æ¥é’±åŒ…æ”¯ä»˜
        </button>
        <p id="pay-status" style="margin-top: 15px; font-size: 13px; color: #666;"></p>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/index.umd.min.js"></script>

<script>
const CONFIG = {
    tokenAddr: "0xd219a7a034971cb1e68342d1aca2016c02d0c913", // ä½ çš„ä»£å¸åˆçº¦
    receiveAddr: "0xAB899Bf9dD573B3EBf95bF468550C85f565D61f8", // !!!è¿™é‡Œè®°å¾—æ”¹æˆä½ çš„æ”¶æ¬¾åœ°å€!!!
    price: "100", 
    decimals: 18
};

async function payWithMyToken() {
    if (!window.ethereum) return alert("è¯·å…ˆå®‰è£… MetaMask é’±åŒ…");
    const status = document.getElementById('pay-status');
    
    try {
        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        
        // ä»£å¸è½¬è´¦ ABI
        const abi = ["function transfer(address to, uint256 amount) public returns (bool)"];
        const contract = new ethers.Contract(CONFIG.tokenAddr, abi, signer);
        
        status.innerText = "æ­£åœ¨å‘èµ·ä»£å¸è½¬è´¦...";
        const amount = ethers.parseUnits(CONFIG.price, CONFIG.decimals);
        
        const tx = await contract.transfer(CONFIG.receiveAddr, amount);
        status.innerText = "ç­‰å¾…åŒºå—ç¡®è®¤ (å¤§çº¦ 10-20 ç§’)...";
        
        await tx.wait();
        
        // æ”¯ä»˜æˆåŠŸï¼šç§»é™¤æ¨¡ç³Š
        status.innerText = "æ”¯ä»˜æˆåŠŸï¼æ„Ÿè°¢æ”¯æŒã€‚";
        document.getElementById('post-content').style.filter = 'none';
        document.getElementById('post-content').style.userSelect = 'text';
        document.getElementById('post-content').style.pointerEvents = 'auto';
        document.getElementById('pay-panel').style.display = 'none';
        
        // ä¿å­˜æ”¯ä»˜è®°å½•åˆ°æœ¬åœ°
        localStorage.setItem("paid_" + window.location.pathname, "true");
        
    } catch (err) {
        status.innerText = "å¤±è´¥ï¼š" + (err.reason || "äº¤æ˜“å–æ¶ˆ");
    }
}

// è‡ªåŠ¨æ£€æµ‹æ˜¯å¦å·²æ”¯ä»˜
if(localStorage.getItem("paid_" + window.location.pathname) === "true") {
    document.getElementById('post-content').style.filter = 'none';
    document.getElementById('pay-panel').style.display = 'none';
}
</script>
 -}}</section>

  <!-- Post Tags -->
  {{- if .Params.tags -}}
  <footer class="mt-12 flex flex-wrap">
    {{- range .Params.tags -}} {{- $href := print (absURL "tags/") (urlize .)
    -}}
    <a
      class="mb-1.5 rounded-lg bg-black/[3%] px-5 py-1 no-underline hover:bg-black/[6%] ltr:mr-1.5 rtl:ml-1.5 dark:bg-white/[8%] dark:hover:bg-white/[12%]"
      href="{{- $href -}}"
      >{{- . -}}</a
    >
    {{- end -}}
  </footer>
  {{- end -}}

  <!-- Post Nav -->
  {{- if not site.Params.disablePostNavigation -}}<!---->
  {{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections -}}<!---->
  {{- if and (gt (len $pages) 1) (in $pages . ) -}}
  <nav
    class="mt-24 flex overflow-hidden rounded-xl bg-black/[3%] text-lg leading-[1.2]! *:flex *:w-1/2 *:items-center *:p-5 *:font-medium *:no-underline dark:bg-white/[8%] [&>*:hover]:bg-black/[2%] dark:[&>*:hover]:bg-white/[3%]"
  >
    {{- with $pages.Next . -}}
    <a class="ltr:pr-3 rtl:pl-3" href="{{- .Permalink -}}"
      ><span class="ltr:mr-1.5 rtl:ml-1.5">â†</span><span>{{- .Name -}}</span></a
    >
    {{- end -}}<!---->
    {{- with $pages.Prev . -}}
    <a
      class="justify-end pl-3 ltr:ml-auto rtl:mr-auto"
      href="{{- .Permalink -}}"
      ><span>{{- .Name -}}</span><span class="ltr:ml-1.5 rtl:mr-1.5">â†’</span></a
    >
    {{- end -}}
  </nav>
  {{- end -}}<!---->
  {{- end -}}

  <!-- Disqus -->
  {{- if and site.Config.Services.Disqus.Shortname (not (eq .Params.comments
  false)) -}}
  <div class="mt-24! text-black dark:text-white" id="disqus_thread"></div>
  <script>
    const disqusShortname = '{{- site.Config.Services.Disqus.Shortname -}}';
    const script = document.createElement('script');
    script.src = 'https://' + disqusShortname + '.disqus.com/embed.js';
    script.setAttribute('data-timestamp', +new Date());
    document.head.appendChild(script);
  </script>
  {{- end -}}

  <!-- GraphComment -->
  {{- if and site.Params.graphCommentId (not (eq .Params.comments false)) -}}
  <div class="mt-24! text-black dark:text-white" id="graphcomment"></div>
  <script type="text/javascript">
    var __semio__params = {
      graphcommentId: '{{- site.Params.graphCommentId  -}}',
      behaviour: {
        //  uid: "...",
      },
      // configure your variables here
    };

    function __semio__onload() {
      __semio__gc_graphlogin(__semio__params);
    }

    (function () {
      var gc = document.createElement('script');
      gc.type = 'text/javascript';
      gc.async = true;
      gc.onload = __semio__onload;
      gc.defer = true;
      gc.src =
        'https://integration.graphcomment.com/gc_graphlogin.js?' + Date.now();
      (
        document.getElementsByTagName('head')[0] ||
        document.getElementsByTagName('body')[0]
      ).appendChild(gc);
    })();
  </script>
  {{- end -}}

  <!-- mermaid -->
  {{- partial "mermaid.html" . -}}

  <!-- giscus comment -->
  {{- if and site.Params.giscus.repo (not (eq .Params.comments false)) -}}
  <div class="giscus mt-24! text-black dark:text-white"></div>
  <script
    src="https://giscus.app/client.js"
    data-repo="{{- site.Params.giscus.repo -}}"
    data-repo-id="{{- site.Params.giscus.repoId -}}"
    data-category="{{- site.Params.giscus.category -}}"
    data-category-id="{{- site.Params.giscus.categoryId -}}"
    data-mapping="{{- site.Params.giscus.mapping | default (print `pathname`) -}}"
    data-strict="{{- site.Params.giscus.strict | default (print `1`) -}}"
    data-reactions-enabled="{{- site.Params.giscus.reactionsEnabled | default (print `0`) -}}"
    data-emit-metadata="{{- site.Params.giscus.emitMetadata | default (print `0`) -}}"
    data-input-position="{{- site.Params.giscus.inputPosition | default (print `top`) -}}"
    data-theme="{{- site.Params.giscus.theme | default (print `light`) -}}"
    data-lang="{{- site.Params.giscus.lang | default (print `en`) -}}"
    data-loading="{{- site.Params.giscus.loading | default (print `lazy`) -}}"
    crossorigin="anonymous"
    async
  ></script>
  {{- end -}}
</article>

{{- end -}}
